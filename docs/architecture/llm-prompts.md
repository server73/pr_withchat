# LLM ν”„λ΅¬ν”„νΈ μ„¤κ³„ β€” λ€ν™” λ‹¨κ³„λ³„ μμ‹

> μ¤ν‚¤λ§ κΈ°λ° + LLM νλ‹¨ νΌν•© λ°©μ‹μ—μ„, λ§¤ ν„΄λ§λ‹¤ LLMμ— μ „λ‹¬λλ” ν”„λ΅¬ν”„νΈ κµ¬μ„±

---

## 1. ν”„λ΅¬ν”„νΈ κµ¬μ΅° κ°μ”

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  System Prompt                      β”‚
β”‚  β”β”€β”€ μ—­ν•  λ° ν†¤μ•¤λ§¤λ„               β”‚
β”‚  β”β”€β”€ ν„μ¬ κµ¬λ§¤μ ν• μ¤ν‚¤λ§            β”‚
β”‚  β”β”€β”€ μμ§‘ ν„ν™© (collected/missing)  β”‚
β”‚  β””β”€β”€ μ‘λ‹µ ν•μ‹ (structured output)  β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  Chat History (μµκ·Ό Nν„΄)             β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  User Message (μµμ‹  μ…λ ¥)            β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

## 2. System Prompt (κ³µν†µ κΈ°λ°)

```
λ‹Ήμ‹ μ€ κµ¬λ§¤μ”μ²­ λ„μ°λ―Έ AIμ…λ‹λ‹¤.
μ‚¬μ©μμ™€ μμ—°μ¤λ¬μ΄ ν•κµ­μ–΄ λ€ν™”λ¥Ό ν†µν•΄ κµ¬λ§¤μ”μ²­μ— ν•„μ”ν• μ •λ³΄λ¥Ό μμ§‘ν•©λ‹λ‹¤.

## ν–‰λ™ μ›μΉ™
1. μ‚¬μ©μμ λ©”μ‹μ§€μ—μ„ κ°€λ¥ν• λ¨λ“  ν•„λ“ κ°’μ„ λ™μ‹μ— μ¶”μ¶ν•μ„Έμ”.
2. μ•„μ§ μμ§‘λμ§€ μ•μ€ ν•„λ“κ°€ μμΌλ©΄, μμ—°μ¤λ¬μ΄ ν• λ¬Έμ¥μΌλ΅ μ§λ¬Έν•μ„Έμ”.
3. μ‚¬μ©μκ°€ μ΄μ „μ— λ‹µν• κ°’μ„ μμ •ν•κ³  μ‹¶μ–΄ν•λ©΄, ν•΄λ‹Ή κ°’μ„ μ—…λ°μ΄νΈν•μ„Έμ”.
4. enum νƒ€μ… ν•„λ“λ” ν—μ©λ κ°’ μ¤‘μ—μ„λ§ μ„ νƒν•λ„λ΅ μ•λ‚΄ν•μ„Έμ”.
5. λ¨λ“  ν•„μ ν•„λ“κ°€ μ±„μ›μ§€λ©΄, μμ§‘λ λ‚΄μ©μ„ μ”μ•½ν•κ³  μ μ¶ μ—¬λ¶€λ¥Ό ν™•μΈν•μ„Έμ”.
6. λ€ν™”λ” κ³µμ†ν•κ³  κ°„κ²°ν•κ² μ μ§€ν•μ„Έμ”.

## μ‘λ‹µ ν•μ‹ (JSON)
λ°λ“μ‹ μ•„λ JSON ν•μ‹μΌλ΅λ§ μ‘λ‹µν•μ„Έμ”:
{
  "extracted_fields": { ... },      // μ΄λ² λ©”μ‹μ§€μ—μ„ μƒλ΅ μ¶”μ¶ν• ν•„λ“
  "updated_fields": { ... },        // μμ • μ”μ²­λ ν•„λ“
  "bot_message": "...",             // μ‚¬μ©μμ—κ² λ³΄μ—¬μ¤„ μ‘λ‹µ λ©”μ‹μ§€
  "suggested_options": [...],       // μ„ νƒμ§€ λ²„νΌ (optional, λ°°μ—΄)
  "is_ready_to_submit": false       // λ¨λ“  ν•„μκ°’ μμ§‘ μ™„λ£ μ—¬λ¶€
}
```

---

## 3. λ€ν™” λ‹¨κ³„λ³„ ν”„λ΅¬ν”„νΈ μμ‹

### 3.1 λ€ν™” μ‹μ‘ β€” μΉ΄ν…κ³ λ¦¬ μ„ νƒ μ§ν›„

μ‚¬μ©μκ°€ μ›°μ»΄ ν™”λ©΄μ—μ„ "IT μμ‚°"μ„ μ„ νƒν• μ§ν›„:

```
[System Prompt κ³µν†µ λ¶€λ¶„ μƒλµ]

## ν„μ¬ κµ¬λ§¤μ ν• μ¤ν‚¤λ§
{
  "type": "it_asset",
  "label": "IT μμ‚°",
  "description": "λ…ΈνΈλ¶, λ¨λ‹ν„°, μ„λ²„ λ“± IT μ¥λΉ„ κµ¬λ§¤μ”μ²­",
  "fields": [
    { "key": "equipmentType", "label": "μ¥λΉ„ μΆ…λ¥", "type": "enum", "required": true,
      "values": ["λ…ΈνΈλ¶", "λ°μ¤ν¬ν†±", "λ¨λ‹ν„°", "μ„λ²„/λ„¤νΈμ›ν¬"],
      "description": "κµ¬λ§¤ν•  IT μ¥λΉ„μ μΆ…λ¥" },
    { "key": "specs", "label": "μ‚¬μ–‘", "type": "text", "required": true,
      "description": "ν•„μ”ν• μ¥λΉ„ μ‚¬μ–‘", "placeholder": "μ: Intel i7, RAM 32GB, SSD 1TB" },
    { "key": "quantity", "label": "μλ‰", "type": "number", "required": true,
      "description": "κµ¬λ§¤ μλ‰ (λ€)", "validation": { "min": 1 } },
    { "key": "user", "label": "μ‚¬μ©μ", "type": "string", "required": true,
      "description": "μ¥λΉ„λ¥Ό μ‚¬μ©ν•  μ‚¬λ (μλ ΉμΈ)" },
    { "key": "department", "label": "λ¶€μ„", "type": "enum", "required": true,
      "values": ["κ°λ°ν€", "λ§μΌ€ν…ν€", "κ²½μμ§€μ›ν€", "μΈμ‚¬ν€"],
      "description": "μ‚¬μ©μ μ†μ† λ¶€μ„" }
  ]
}

## μμ§‘ ν„ν™©
- collected: (μ—†μ)
- missing (ν•„μ): equipmentType, specs, quantity, user, department

## λ€ν™” μ΄λ ¥
(μ—†μ β€” μ²« ν„΄)

## μ‚¬μ©μ λ©”μ‹μ§€
"IT μμ‚°"
```

**κΈ°λ€ LLM μ‘λ‹µ:**
```json
{
  "extracted_fields": {},
  "updated_fields": {},
  "bot_message": "IT μμ‚° κµ¬λ§¤μ”μ²­μ΄μ‹κµ°μ”! μ–΄λ–¤ μ¥λΉ„κ°€ ν•„μ”ν•μ‹ κ°€μ”?",
  "suggested_options": ["λ…ΈνΈλ¶", "λ°μ¤ν¬ν†±", "λ¨λ‹ν„°", "μ„λ²„/λ„¤νΈμ›ν¬"],
  "is_ready_to_submit": false
}
```

---

### 3.2 λ‹¨μΌ κ°’ μ…λ ¥

```
## μμ§‘ ν„ν™©
- collected: (μ—†μ)
- missing (ν•„μ): equipmentType, specs, quantity, user, department

## λ€ν™” μ΄λ ¥
Bot: "IT μμ‚° κµ¬λ§¤μ”μ²­μ΄μ‹κµ°μ”! μ–΄λ–¤ μ¥λΉ„κ°€ ν•„μ”ν•μ‹ κ°€μ”?"
User: "λ…ΈνΈλ¶"

## μ‚¬μ©μ λ©”μ‹μ§€
"λ…ΈνΈλ¶"
```

**κΈ°λ€ LLM μ‘λ‹µ:**
```json
{
  "extracted_fields": { "equipmentType": "λ…ΈνΈλ¶" },
  "updated_fields": {},
  "bot_message": "λ…ΈνΈλ¶ κµ¬λ§¤ μ”μ²­μ΄μ‹λ„¤μ”. ν•„μ”ν• μ‚¬μ–‘μ„ μ•λ ¤μ£Όμ„Έμ”.",
  "suggested_options": [],
  "is_ready_to_submit": false
}
```

---

### 3.3 λ‹¤μ¤‘ ν•„λ“ λ™μ‹ μ¶”μ¶ (ν•µμ‹¬ μΌ€μ΄μ¤)

```
## μμ§‘ ν„ν™©
- collected: (μ—†μ)
- missing (ν•„μ): equipmentType, specs, quantity, user, department

## λ€ν™” μ΄λ ¥
Bot: "IT μμ‚° κµ¬λ§¤μ”μ²­μ΄μ‹κµ°μ”! μ–΄λ–¤ μ¥λΉ„κ°€ ν•„μ”ν•μ‹ κ°€μ”?"

## μ‚¬μ©μ λ©”μ‹μ§€
"κ°λ°ν€ μ‹ μ… 3λ…μ΄ μ“Έ λ…ΈνΈλ¶μ΄ ν•„μ”ν•©λ‹λ‹¤. i7μ— 32κΈ°κ°€ λ¨μ΄λ©΄ μΆ‹κ² μ–΄μ”."
```

**κΈ°λ€ LLM μ‘λ‹µ:**
```json
{
  "extracted_fields": {
    "equipmentType": "λ…ΈνΈλ¶",
    "quantity": 3,
    "specs": "Intel i7, RAM 32GB",
    "department": "κ°λ°ν€"
  },
  "updated_fields": {},
  "bot_message": "μ •λ¦¬ν•λ©΄, κ°λ°ν€ μ‹ μ… 3λ…μ„ μ„ν• λ…ΈνΈλ¶(i7/32GB) κµ¬λ§¤ μ”μ²­μ΄μ‹κµ°μ”. μ¥λΉ„λ¥Ό μλ Ήν•  λ‹΄λ‹Ήμ μ΄λ¦„μ„ μ•λ ¤μ£Όμ‹κ² μ–΄μ”?",
  "suggested_options": [],
  "is_ready_to_submit": false
}
```

> **ν¬μΈνΈ**: ν• λ¬Έμ¥μ—μ„ 4κ° ν•„λ“(equipmentType, quantity, specs, department)λ¥Ό λ™μ‹ μ¶”μ¶.
> λ‚¨μ€ ν•„μ ν•„λ“(user)λ§ μμ—°μ¤λ½κ² μ§λ¬Έ.

---

### 3.4 κ°’ μμ • μ”μ²­

```
## μμ§‘ ν„ν™©
- collected: { equipmentType: "λ…ΈνΈλ¶", quantity: 3, specs: "Intel i7, RAM 32GB", department: "κ°λ°ν€", user: "κΉ€μ‹ μ…" }
- missing (ν•„μ): (μ—†μ β€” λ¨λ“  ν•„μκ°’ μμ§‘ μ™„λ£)

## λ€ν™” μ΄λ ¥
Bot: "μ•„λ λ‚΄μ©μΌλ΅ IT μμ‚° κµ¬λ§¤μ”μ²­μ„ μ μ¶ν• κΉμ”? ..."
(μ”μ•½ μΉ΄λ“ ν‘μ‹)

## μ‚¬μ©μ λ©”μ‹μ§€
"μ•„ μ κΉ, 3λ€κ°€ μ•„λ‹λΌ 5λ€λ΅ λ³€κ²½ν•΄μ£Όμ„Έμ”. κ·Έλ¦¬κ³  μ‚¬μ–‘λ„ i9λ΅ λ°”κΏ”μ£Όμ„Έμ”."
```

**κΈ°λ€ LLM μ‘λ‹µ:**
```json
{
  "extracted_fields": {},
  "updated_fields": {
    "quantity": 5,
    "specs": "Intel i9, RAM 32GB"
  },
  "bot_message": "μλ‰μ„ 5λ€λ΅, μ‚¬μ–‘μ„ i9μΌλ΅ λ³€κ²½ν–μµλ‹λ‹¤. μμ •λ λ‚΄μ©μΌλ΅ μ μ¶ν• κΉμ”?",
  "suggested_options": ["μ μ¶ν•κΈ°", "λ‹¤μ‹ μμ •"],
  "is_ready_to_submit": true
}
```

---

### 3.5 λ¨λ“  ν•„μκ°’ μμ§‘ μ™„λ£ β€” ν™•μΈ μ”μ²­

```
## μμ§‘ ν„ν™©
- collected: { equipmentType: "λ…ΈνΈλ¶", quantity: 5, specs: "Intel i9, RAM 32GB", department: "κ°λ°ν€", user: "κΉ€μ‹ μ…" }
- missing (ν•„μ): (μ—†μ)

## μ‚¬μ©μ λ©”μ‹μ§€
"κΉ€μ‹ μ…"
```

**κΈ°λ€ LLM μ‘λ‹µ:**
```json
{
  "extracted_fields": { "user": "κΉ€μ‹ μ…" },
  "updated_fields": {},
  "bot_message": "λ¨λ“  μ •λ³΄κ°€ μ…λ ¥λμ—μµλ‹λ‹¤. μ•„λ λ‚΄μ©μΌλ΅ κµ¬λ§¤μ”μ²­μ„ μ μ¶ν• κΉμ”?\n\n- μ¥λΉ„: λ…ΈνΈλ¶\n- μ‚¬μ–‘: Intel i9, RAM 32GB\n- μλ‰: 5λ€\n- μ‚¬μ©μ: κΉ€μ‹ μ…\n- λ¶€μ„: κ°λ°ν€",
  "suggested_options": ["μ μ¶ν•κΈ°", "μμ •ν•κΈ°", "μ·¨μ†"],
  "is_ready_to_submit": true
}
```

---

### 3.6 μ ν¨μ„± μ¤λ¥ μ²λ¦¬

```
## μμ§‘ ν„ν™©
- collected: { equipmentType: "λ…ΈνΈλ¶" }
- missing (ν•„μ): specs, quantity, user, department

## μ‚¬μ©μ λ©”μ‹μ§€
"μλ‰μ€ λ§μ΄λ„μ¤ 3λ€μ”"
```

**κΈ°λ€ LLM μ‘λ‹µ:**
```json
{
  "extracted_fields": {},
  "updated_fields": {},
  "bot_message": "μλ‰μ€ 1 μ΄μƒμ μ«μλ΅ μ…λ ¥ν•΄μ£Όμ„Έμ”. λ‡ λ€κ°€ ν•„μ”ν•μ‹ κ°€μ”?",
  "suggested_options": [],
  "is_ready_to_submit": false
}
```

---

### 3.7 λ§¥λ½ λ²—μ–΄λ‚ μ§λ¬Έ μ²λ¦¬

```
## μμ§‘ ν„ν™©
- collected: { equipmentType: "λ…ΈνΈλ¶", specs: "i7/32GB" }
- missing (ν•„μ): quantity, user, department

## μ‚¬μ©μ λ©”μ‹μ§€
"μ¤λ λ‚ μ”¨ μ–΄λ•?"
```

**κΈ°λ€ LLM μ‘λ‹µ:**
```json
{
  "extracted_fields": {},
  "updated_fields": {},
  "bot_message": "μ£„μ†΅ν•©λ‹λ‹¤, μ €λ” κµ¬λ§¤μ”μ²­ λ„μ°λ―ΈλΌ λ‚ μ”¨ μ •λ³΄λ” μ–΄λ µμµλ‹λ‹¤ π… κµ¬λ§¤μ”μ²­μ„ κ³„μ† μ§„ν–‰ν• κΉμ”? λ‡ λ€κ°€ ν•„μ”ν•μ‹ μ§€ μ•λ ¤μ£Όμ„Έμ”.",
  "suggested_options": [],
  "is_ready_to_submit": false
}
```

---

## 4. ν”„λ΅ νΈμ—”λ“ μ²λ¦¬ νλ¦„

```typescript
// λ§¤ ν„΄ μ²λ¦¬ μμ‚¬μ½”λ“
async function handleUserMessage(userText: string) {
  // 1. ν”„λ΅¬ν”„νΈ μ΅°λ¦½
  const prompt = buildPrompt({
    schema: currentSchema,          // ν„μ¬ κµ¬λ§¤μ ν• μ¤ν‚¤λ§
    collected: collectedFields,     // μ§€κΈκΉμ§€ μμ§‘λ κ°’
    missing: getMissingFields(),    // μ•„μ§ λ―Έμμ§‘μΈ ν•„μ ν•„λ“
    history: chatHistory,           // μµκ·Ό λ€ν™” μ΄λ ¥ (μµλ€ 20ν„΄)
    userMessage: userText,          // μ‚¬μ©μ μµμ‹  μ…λ ¥
  });

  // 2. LLM API νΈμ¶
  const response = await callLLM(prompt);

  // 3. μμ§‘ μƒνƒ μ—…λ°μ΄νΈ
  Object.assign(collectedFields, response.extracted_fields);
  Object.assign(collectedFields, response.updated_fields);

  // 4. UI λ λ”λ§
  addBotMessage(response.bot_message);
  if (response.suggested_options?.length) {
    showQuickReplyButtons(response.suggested_options);
  }

  // 5. μ μ¶ μ¤€λΉ„
  if (response.is_ready_to_submit) {
    showSummaryCard(collectedFields);
    showSubmitButton();
  }
}
```

---

## 5. ν† ν° μµμ ν™” μ „λµ

| μ „λµ | μ„¤λ… |
|------|------|
| **μ¤ν‚¤λ§ μΊμ‹±** | κ°™μ€ κµ¬λ§¤μ ν• λ‚΄ λ€ν™”μ—μ„ μ¤ν‚¤λ§λ” λ³€ν•μ§€ μ•μΌλ―€λ΅ system prompt μΊμ‹± ν™μ© |
| **μ΄λ ¥ μλ„μ°** | μ „μ²΄ λ€ν™” μ΄λ ¥ λ€μ‹  μµκ·Ό 10~20ν„΄λ§ ν¬ν•¨ |
| **μμ§‘ ν„ν™© μ”μ•½** | λ§¤ ν„΄λ§λ‹¤ collected/missingμ„ κ°„κ²°ν•κ² μ”μ•½ν•μ—¬ μ „λ‹¬ |
| **λ¶ν•„μ”ν• ν•„λ“ μ μ™Έ** | μ΄λ―Έ μμ§‘ μ™„λ£λ ν•„λ“λ” μ¤ν‚¤λ§μ—μ„ description μƒλµ κ°€λ¥ |

---

## 6. κ³ κ°μ‚¬ μ»¤μ¤ν„°λ§μ΄μ§• μν–¥

μ¤ν‚¤λ§κ°€ λ³€κ²½λλ©΄ ν”„λ΅¬ν”„νΈμ "ν„μ¬ κµ¬λ§¤μ ν• μ¤ν‚¤λ§" λ¶€λ¶„λ§ μλ™μΌλ΅ λ³€κ²½λ¨.

**μ: κ³ κ°μ‚¬ Aκ°€ "μμ‚°λ²νΈ" ν•„λ“λ¥Ό μ¶”κ°€ν• κ²½μ°**

μ¤ν‚¤λ§μ— ν•„λ“ μ¶”κ°€:
```json
{ "key": "assetNumber", "label": "μμ‚°λ²νΈ", "type": "string", "required": true,
  "description": "κΈ°μ΅΄ μμ‚°κ³Ό κµμ²΄ μ‹ κΈ°μ΅΄ μμ‚°λ²νΈ", "placeholder": "μ: IT-2025-001" }
```

β†’ LLMμ€ μλ™μΌλ΅ "μμ‚°λ²νΈ"λ„ μμ§‘ λ€μƒμ— ν¬ν•¨ν•μ—¬ μ§λ¬Έν•¨.
β†’ μ½”λ“ λ³€κ²½ μ—†μ΄ μ¤ν‚¤λ§ μ„¤μ •λ§μΌλ΅ λ€ν™” νλ¦„μ΄ λ³€κ²½λ¨.
